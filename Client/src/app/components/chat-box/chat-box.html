<div class="d-flex chat-box flex-column h-100 py-2 border-0 overflow-auto bg-light rounded-3 shadow-sm">
  <div class="h-100">
    <!-- Load More Button -->
    @if (_chatService.chatMessages().length > 5) {
    <div class="text-center py-2 sticky-top bg-light">
      <button class="text-secondary small shadow-sm px-4 py-2 rounded bg-white border border-light hover:bg-body-tertiary">
        @if (_chatService.isLoading()) {
        <div class="d-flex align-items-center justify-content-center gap-2">
          <mat-spinner diameter="18" strokeWidth="3"></mat-spinner>
          <span>Loading...</span>
        </div>
        } @else { Load more }
      </button>
    </div>
    }
    <!-- Chat Messages -->
    @for (item of _chatService.chatMessages(); track item.id) {
      @if (item.senderId?.trim() !== _authService.currentUser?.id?.toString()?.trim()) {
      <!-- Received Message -->
      <div class="d-flex mb-4 align-items-end">
        <div class="position-relative me-2">
          <img
            [src]="_chatService.currentOpenChat()?.profilePicture || 'https://randomuser.me/api/portraits/lego/5.jpg'"
            [alt]="_chatService.currentOpenChat()?.fullName"
            class="rounded-circle border shadow-sm chat-avatar"
          />
        </div>

        <div class="chat-bubble received position-relative ms-2">
          <div class="chat-arrow chat-arrow-left"></div>
          <span class="small d-block">{{ item.content }}</span>
          <span class="chat-time">{{ item.sendingTime | date : 'shortTime' }}</span>
        </div>
      </div>
      } @else {
      <!-- Sent Message -->
      <div class="d-flex justify-content-end mb-4 align-items-end">
        <div class="chat-bubble sent position-relative me-2 ms-2">
          <div class="chat-arrow chat-arrow-right"></div>
          <span class="small d-block">{{ item.content }}</span>
          <span class="chat-time">{{ item.sendingTime | date : 'shortTime' }}</span>
        </div>

        <div class="position-relative ms-2">
          <img
            [src]="_authService.currentUser?.imageProfile || 'https://randomuser.me/api/portraits/lego/5.jpg'"
            [alt]="_authService.currentUser?.fullName"
            class="rounded-circle border shadow-sm chat-avatar"
          />
        </div>
      </div>
      }
    } @empty {
      <!-- No Messages -->
      <div class="d-flex flex-column align-items-center justify-content-center text-center py-5 text-muted h-100">
        <mat-icon class="text-secondary mb-2">chat</mat-icon>
        <h6 class="fw-semibold mb-2 text-dark">No Messages Yet</h6>
        <p class="small mb-0 text-secondary">
          Start the conversation by sending a message below ðŸ’¬
        </p>
      </div>
    }
  </div>
</div>
